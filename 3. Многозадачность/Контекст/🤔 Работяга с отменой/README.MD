ü§î **–†–∞–±–æ—Ç—è–≥–∞ —Å –æ—Ç–º–µ–Ω–æ–π**

–Ø —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª —Ç–∏–ø-—Ä–∞–±–æ—Ç—è–≥—É Worker. –û–Ω –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –≤ —Ü–∏–∫–ª–µ, –ø–æ–∫–∞ —Ç–∞ –Ω–µ —Å–ª–æ–º–∞–µ—Ç—Å—è:

```go
// Worker –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –≤ —Ü–∏–∫–ª–µ, –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.
// –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è, —á—Ç–æ Worker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–π –≥–æ—Ä—É—Ç–∏–Ω–µ.
type Worker struct {
    fn func() error
}

// NewWorker —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä Worker —Å –∑–∞–¥–∞–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π.
// –ù–æ –ø–æ–∫–∞ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ü–∏–∫–ª —Å —Ñ—É–Ω–∫—Ü–∏–µ–π.
func NewWorker(fn func() error) *Worker {
    return &Worker{fn: fn}
}

// Start –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é –≥–æ—Ä—É—Ç–∏–Ω—É, –≤ –∫–æ—Ç–æ—Ä–æ–π —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏
// –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é, –ø–æ–∫–∞ —Ç–∞ –Ω–µ –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É.
func (w *Worker) Start() {
    go func() {
        for {
            err := w.fn()
            if err != nil {
                return
            }
        }
    }()
}
```

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```go
count := 3
fn := func() error {
    fmt.Print(count, " ")
    count--
    if count == 0 {
        return errors.New("count is zero")
    }
    time.Sleep(10 * time.Millisecond)
    return nil
}

worker := NewWorker(fn)
worker.Start()

time.Sleep(35 * time.Millisecond)
// 3 2 1
```

–¢–µ–ø–µ—Ä—å –ø—Ä–∏—à–ª–æ –≤—Ä–µ–º—è –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å —Ä–∞–±–æ—Ç—è–≥—É –ø–æ–¥ –Ω–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è.

‚ûä –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ Stop, –∫–æ—Ç–æ—Ä—ã–π –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—è–≥—É:

```go
count := 9
fn := func() error {
    fmt.Print(count, " ")
    count--
    time.Sleep(10 * time.Millisecond)
    return nil
}

worker := NewWorker(fn)
worker.Start()
time.Sleep(105 * time.Millisecond)
worker.Stop()

fmt.Println()
// 9 8 7 6 5 4 3 2 1 0
```

‚ûã –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ AfterStop. –û–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–∞ –ø–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–∞–±–æ—Ç—è–≥–∏:

```go
fn := func() error { return nil }

worker := NewWorker(fn)
worker.AfterStop(func() {
    fmt.Println("called after stop")
})

worker.Start()
worker.Stop()

time.Sleep(10 * time.Millisecond)
// called after stop
```

‚ûå –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ Err, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∏—á–∏–Ω—É –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ (–ª–∏–±–æ —Ñ—É–Ω–∫—Ü–∏—è —Å–ª–æ–º–∞–ª–∞—Å—å, –ª–∏–±–æ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ Stop).

–î–æ—Ä–∞–±–æ—Ç–∞–π—Ç–µ Worker –ø–æ–¥ –Ω–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è. –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –∏ –Ω—é–∞–Ω—Å—ã ‚Äî –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –ø–æ –∫–æ–¥—É.

